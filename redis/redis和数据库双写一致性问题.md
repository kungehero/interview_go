# redis和数据库双写一致性问题
```
A.要求强一致性的场景下:

方案一：可通过分布式锁，将并行更新的场景先串行化，避免并发导致的数据覆盖。

           1  这样可以先删除 cache，

           2  更新DB，

           3  再更新一下cache。

        这样即使更新cache 失败，下一次查询也会补充上。

方案二：定时任务方式.

             搞一个 job，定时去扫DB中的数据，然后更新redis 缓存。

 

允许一定时间的不一致，保证最终一致性即可的场景下:

      方案一 基于消息队列解决:

            1  先更新DB，

            2  再将结果投递到rocketMq 中，由MQ的消费者去更新cache。

注: 这里只需要保证MQ不丢消息，通过ack机制，可以保证最终一致性。这里对DB是主从同步的架构下，如果发生同步延迟，写主读从时，可能会导致不一致。
不过，这个概率相对更低。担心的话，可以写主读主。
```
